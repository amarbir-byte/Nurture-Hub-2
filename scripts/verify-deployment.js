// Deployment verification script
// Run this after deployment to verify everything is working

const chalk = {
  green: (text) => `\x1b[32m${text}\x1b[0m`,
  red: (text) => `\x1b[31m${text}\x1b[0m`,
  yellow: (text) => `\x1b[33m${text}\x1b[0m`,
  blue: (text) => `\x1b[34m${text}\x1b[0m`,
  bold: (text) => `\x1b[1m${text}\x1b[0m`
}

async function verifyDeployment(baseUrl) {
  console.log(chalk.bold('\nğŸ” Verifying Nurture Hub Deployment...\n'))

  const checks = [
    {
      name: 'Homepage loads',
      test: async () => {
        const response = await fetch(baseUrl)
        return response.ok
      }
    },
    {
      name: 'PWA manifest available',
      test: async () => {
        const response = await fetch(`${baseUrl}/manifest.webmanifest`)
        return response.ok || response.status === 404 // Generated by Vite PWA
      }
    },
    {
      name: 'Service worker registered',
      test: async () => {
        const response = await fetch(`${baseUrl}/sw.js`)
        return response.ok || response.status === 404 // Generated by Vite PWA
      }
    },
    {
      name: 'Assets loading correctly',
      test: async () => {
        const response = await fetch(`${baseUrl}/vite.svg`)
        return response.ok
      }
    }
  ]

  let passedChecks = 0

  for (const check of checks) {
    try {
      const result = await check.test()
      if (result) {
        console.log(`${chalk.green('âœ…')} ${check.name}`)
        passedChecks++
      } else {
        console.log(`${chalk.red('âŒ')} ${check.name}`)
      }
    } catch (error) {
      console.log(`${chalk.red('âŒ')} ${check.name} - Error: ${error.message}`)
    }
  }

  console.log(`\n${chalk.bold('Results:')} ${passedChecks}/${checks.length} checks passed`)

  if (passedChecks === checks.length) {
    console.log(chalk.green('\nğŸ‰ Deployment verification successful!'))
    console.log(chalk.blue(`\nğŸ”— Your app is live at: ${baseUrl}`))
    console.log(chalk.yellow('\nğŸ“§ Ready for beta testing! Send invites to beta testers.'))
  } else {
    console.log(chalk.red('\nâš ï¸  Some checks failed. Please review the deployment.'))
  }

  // Additional manual checks reminder
  console.log(chalk.bold('\nğŸ“‹ Manual checks to perform:'))
  console.log('â€¢ Test user registration and login')
  console.log('â€¢ Verify Supabase database connection')
  console.log('â€¢ Test Stripe subscription flow (test mode)')
  console.log('â€¢ Check mobile responsiveness')
  console.log('â€¢ Verify PWA installation works')
  console.log('â€¢ Test offline functionality')
  console.log('â€¢ Confirm beta feedback widget appears for test accounts')
}

// Get URL from command line or use default
const deploymentUrl = process.argv[2] || 'https://nurture-hub.vercel.app'

verifyDeployment(deploymentUrl).catch(console.error)